package lab.lab.lab6_6p2_GOL;

import java.awt.*;
import java.awt.event.*;
import java.util.Hashtable;
import java.util.Scanner;

import javax.swing.*;
import javax.swing.event.*;

/**
 * Conway's Game of Life is a cellular automata that can be thought of as
 * simulating towns, created and destroyed through over- and under-population.
 * This is the main class that uses the Cell class. It uses Java Swing to
 * display the graphics.
 * 
 * @author Eric Kugel
 */
public class GameOfLife extends JFrame {
  // final class variables
  public static final int gridSize = 40;
  public static final int speed = 1000 / 3;

  // global variables
  private Cell[][] cells = new Cell[gridSize][gridSize];
  private CellButton[][] buttons = new CellButton[gridSize][gridSize];
  public static boolean running = false;

  /**
   * Checks the Cell class against a previously confirmed board.
   * If the Cell class is correct, it does nothing,
   * otherwise, it alerts the user and asks if the program should continue.
   */
  private void testCell() {
    // hardcoded grids, 0 = dead, 1 = alive
    String check = "0111101011110001111111011111101111101110011111011011101111111101110011011000101001111111011111110100,0001101100111111011110000100101110111111111111111011111111010111111111101011111010101111111101111000,0110101100111110001111101011110011111111111110111011111001110101001011111111001110011111001101101100,1111000111111100110110101001011101110101001111010110110011101100001110111010110111111100001111001101,0010111110111011111010110010011110111111101011110111111011101101001101111111111111110110111110001101,1111011110100100001100101111111000111111101100110111110101110111111010111110111110111111011111001001,0110011111011101100101000000110010110111101011111111110101010011001101011000110110101100101100011010,1001001001110000111011111101111100011111101100110101111110101111110101111011001101110111001011010001,0000100010110110111101000111101011111001101010101101111101110101001111001011001001111111111010101110,0110000110010101110110111110110011011111111101001101111001110101111100101011100001101111011111101111,1110101101111000101111010011111010011101101111001001011111110011011101110101110001110111111100111011,1111111011111010110011110100011110011100110111001111110111111111111001000111111101111101110100011111,1011111001001111111101111011111100101110011001011111101110110111011000000110100111001011010100111011,1110011010101110110001110011101111000110111001001011011011110011111001010110000111011111101111111110,1000101111010010100110110011110110011011000010101011111110011111111011101110010110111100011100011111,0101001100001101001010111111011110111011101011010010111101111111111111101011100111010110111001101110,0110101111011101101100111100101101101010101110010111000110111100111101000110111110001011001101011101,1111000010101011101111011101011010110011111100101101110010111010101000011111111011111111111111011111,0101011110100111011111101111100110110110101111010011101101110110101101110111111001111110111010010011,0101011011110011000011011110110011011111111111001111111111011100111011111110111011001011111011000010,1011000011110011101001111010101111110011111001110011110101101101111111000111000111111101111011110111,1101111110011101110100110001111010101110111111011111111011011001101000110111111101100111111101110011,1111100010001011111111001010111110111111011101110101111111010111111110010010010111111111001110110111,1111110110111010111011110111011101011111111101011110100101110111010111011011101110011101100101110001,1010011011111110000011010010100100001101111101100001010010011011111111011111111111111110011111101011,1010110111111111011010101010011101101111111011100011111000011111000101111001101010111101111010111000,1111111111111110110111000011011101111000101001100101010011110001011000111101011011111110010011111111,1111111111010011110101110110001111110111110000110110100101111101111101010111011111011001111101011111,1011110001011100111100110011010000111000111000011110011100111001010001000010110111101111101110111110,0011111000001101101011011001101111001100110010111011111111001111011101111110011111010111001011111101,1011100000111011101111110011010000011111110111111111111111101111101011101000111011100111010101010111,1111110111111101111111101000101111111011110001101111111011110101011111110101101111100101100111101000,1111001001100011110111101001011111011110110101101100111111001111100100111010101110101100110101001001,1001011111011110011110111111111110101110101000101110111101001010110011100011101001111111011111111001,1111100101110100101111011111001111010111111111101111111100100101111001101111001111001110111001101111,1011001110111100011111111111110111111100111110000010100111101011111101001111011011010001101101000111,1100101111011111110101001111111101010000101000111011000100001001011110111100010011100011011110101111,1011111010111111110011110110111111111110001110111100010010010011011110011011110111111111110110110110,1011110011110111001111011111111111111011110111111101100101101010101100010101101111110010001100010100,1111111011110110101101101101111111111111110101100110111010101110001111001111111010101001110101111110,0101111110011101010010111101101111001011111001111010111101111111011111111001110111111111100011010011,1010100011011001101000111111011101100010010011111001111010001011100011111110001001110011011110101101,0110010010111001101111011100011010111100111101010000011101100111110110111011111100110111000010111111,1110010110010011001100110111110100001110001011110010110111101111101111111100000101010011010001011101,0110100101000011101011110001001001001111110101111010101110011110111011011101111111000111111110011111,1101111011110111101111111001110010011111111011110101101110010011110101111011110011101110101101111101,1010001101100111101011111110111110111010100110101111010111101110000010110100101110101010111100101111,1110011001111110011001111110111101101011111101111111001110111100101101111111011011110111001111111000,1001111101101011101011100001111010101101101011110111001111101010101111101111110101100110111100110010,1110110011100010010011111001011010101111111010111111111001011101101101111110110011011010110010100000,1101111110100110110011010001011111111101111110110111001100011011010011111100111001111101011101110100,1110010101111111001111110001000101000111001101111101111111010110011000101111010011000111100000111101,0101100110101001101110101111101101110001110111111100101110111011101011001111011101111001100101111101,0110101101001011111011111110111111000111110001101110110111110111111100100100000111100101001111011001,0000111101111111100111111011101101010111110111011111010100110110000111010011111110001011101101110111,1010100100101011010011011100100001101101111101001111100101111111101111101110111111101111111110101111,0101101111100011011111110011101101111111111111111011010011010111111111111010010101111111111010010111,1101000110101101100011011101111011111011000111100110111001000011110011001010111101111111111011010011,1001111010111000011110110110011110111101101100010100111111101010011110100111111010111000011011111101,1001111001011111001100100110011110110011111111011101111111111000101100011100110110001010101111101110,1111101111110100111110001111001110111111111101111011100101001100111111111100100111101111111001011011,0111111110010110111111101101101101111011111111111101111111011110101010111111000111101010011011111110,1110100010011111110110011011111111111011111111111010110111000011111000011111111011101100000101111111,1000111011100111110000111111011111101110011100110100110101101110011111010101111011111101101110110100,1100111100001110001110110011110111111010010110100001101001111001100101001100101111100010001111111101,0111101101011111111001101010111111111001111110100101110110011111100110100011011110111110001110111000,1111011011111111101111111101010010111111000001111001111100111011000010011101110111111111111100111010,0110001111111111101101001111111101000100111110110011101111110110101000001111110110111110111001110101,1101111011010111000011110111110111000111111110110011111100101100110010000110011000011010111110011101,0001110011111000010100000010101000011110110111011110111110110100100111101011111000111011110010101111,1111111110101011110011011101111101111101111000011111011101100101111110111101101111110110110110111101,1101101111011111101010101110001010111100111101111111100010101111110011111011111111111101000011101001,1110111011110111111101111111111011110101111111110010011001011001000011000110110101011101100111111001,1111011111110111110111111000101100111011111111011010111110110011110101111110001001111111110110111011,1011111111111011010011011100111010011110011110110101111101111101111111110101110111011101101110101100,0110111101111011111111110011011101111101111111110110110011000111111111101111100010001001001101110110,0000111100011101110100011000111000100010111110110111010101110111111011011010110101111101111111111110,0110100101101011100111101110110111011011111110111110110000111011100000011111101100101010100110010111,1100111110011011101100110101111001011111111111110110011110111100110011111110101111111111111010001111,1110010011101111001001110101010110111111101011110011001101110110110111111101011011011111111111001010,1110111111000101110110101110010101100100011110101110111111001000111100100001110011101011010110011101,1100011110101111111110111111001100111001001110001011011011100100111110111110001011110011100110110010,1111011001101111110101100101111011011011111110001111110011110111101110000111100111110101111101110110,1101011111111111011101110010011101001011110111001101101011011011011111110110110110101111111111110110,0111111011100100011101001110100000111111101011111101111100011010011101111101011111111000111111111110,1010011111000111111101011010011011101101000110010111101001011101001011011110111101111111110110111010,1111011111111101100110001100010010011111110011010111110010001111111111101100011010101001101110111101,0101010111100111000111111101111101101110111001110101011111011111001011111101101101100100111110011011,1110111110111100110111111101111110111011111101001110011010100011110111101001100111111100001011100110,1010011100110000110111011111101110101011101101101011101111010001011100000100011111111111111111110110,1001110110011000101010101100000111111000011000110100110111010111010011001000111111111100100111010011,1101111000111000111100110000101111111101111101111111111111111011011111010010001100110100100110111010,0100100110011100110001100111111101101101101101111001000001010010111111101110111011010110001110110010,1110010101111001000111101111110000111000111101010011010111111011111110111010110001010111000100100011,1110111011101001011001111110100010101111011101100011111101111110101110111011110111111111001111110101,1111110111110001111111011101010011111101111001101111010111001110010101111110111110101110111100101110,1111000011101111111110011111001111111111100101101101011011111010110111110111110011111111111101100001,0001011111011101111001010111111111111111100110101111110011110111011111111111111111011111011010010101,1111111111101101111110111011111101110010111110011110110101010111011111011111101101111001010110110110,0111110110111110111110101110101101111101110111111001010011110011000111011000101101111010011001110111";
    String answer = "0010101011000101000001001111101000100000000000001010000000010100000000011100101101100000000000000000,0000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000,1000100000000000000000101010000000000000000000000000000000000001000000000000000000000000000000000010,1000000000000000000000001000000000000000000000000000000000000000010000000000000000000000100000100000,0000000000000011000010100000000010000000000000000000000000000001000000000000000000000000100000010001,1000000000000000000000101110000010000000001000000000000100000000000000000000000000000000000001000001,0000000000000111100000000000000001000000000010000000000000000000000000000000000000000000100000011111,0111101000000000000000011100000000000000001000000000000000000000010000000010000000000000000011000001,0111000010000110000000000000000000000000000010100000000000000000000000001000011100000000000000000000,1010011000000100000000010000000000000000000000100000000000000100000000001000000010000000000000000000,0000100000000010000000000000000000000000000000110000000000000000000001010000000000000000000000000000,0000000000000010000000000100000011100000000000000000000000000000000011000000000100000000000110000000,0000000000000000000100000000000000100000000001010000000000000000000100100000100000000000000000000000,1010000000100000000000000000000001100000101111000000000000000000000011010000000000000000000001000000,1001100001110000101110000000000000000000001010101000000000000000000000000000100000000000000000000001,1101100000000000001010000000000000000000101000010000000000000000000000001000000000000000100001000000,0000111001100000000000000000000000001000000000010000000000000000000001000000000000000000000000000001,1000000000100000000000000000000000000000000000100000010000000010100001010000000000000000000001000000,0001010000001000010000000000000000000000000000010000000000000010100000000000000000000000000000010000,1101010000001000000000000000000000000000000000001000000000000000000000000000000000000000000000011000,1000000000000000001100000010000000000000000000000000000000000000000000000000000000000000000000011100,0000011000000000000000000010000000000000000000000000000000000000000000110000010000000000000000000000,0000000000100000000000001000000000000000000000000000000000000000000000000000000000000000000000000100,0000000000000000000000010000000001000000000000000100000000000000000000000000000000000000100000000000,1000000000000000000000000000100001000000000000001000000111000000010000000000000000000000000000001111,1000000000000000011000110010000001000000000000010000001110000000000000000000000000000001000000000000,0000000000000000000000001001100000000000001110001100000110000000000000000000000000000000000000000001,0000000000000000000000011100000000000110000001000000100100000101000111010000000000000000000000000000,1000000001010000000000000000010000000000001001000000000000000000000001000000000000000000000000000000,0000001000000000000000001100001111000000000010000000000000000000000100001010000000010000000000000001,1000000110000000000000000110000000000000000100000000000000000000000000000000000000010000010000000001,0000011110000000000000001110000000000000000100000000000000000000000000000110000000000000000100001001,0000000000000000000000000000000000000000000010000000000000000000000000001000000000000000000000001100,0000010000000000000000000000000000000000000000000000000001111000000110000000100000000000000000000001,1000000000000000100000000000000000000000000000101000000000101000000000001000000000000000000000000000,0000000000000000000000000000000000000100000000000000000001101000000000000001010000011000000000000000,1000000000000000000000000000000000000011100000100011101100101000000000100000000000000000000000100000,1000000000000000000000000000000000000010000000000000001111111010000001000000000000001000000000100001,1000000000000000000000000000000000000000000000000001000100101000100001110000000000000000000000000000,1000000000000000100000000000000000000000000100000000000000000000100000000000000000000000010101000001,0000000000000000000010000000000000001000000100000010000000100000010000000000000000000000000000000001,1000000000000000001000000001000000000010000000000101000000000000000000000000000000000000011000000000,0000111000000100000011000000000010100001100000000000000000100000000000000001110100000100010010000001,1000110100011100000000000101000111100000000000000100100000000000000000000000000001010000010001000000,0000000000011000000000000100001110000000000000000010000000000000000000000000000000010000000000000001,1000100000011000001000000000000010000000000000000000000000000000000100000000000000101000000001000000,0000000000000000000000000000000000000000000000000000010000000000000000000000000000000000100000000001,1010000000000000001000000000000000000000000000000000010000000000001000000000000000000000000000000001,0000000100001000101000000000000010100000000000000000000000000010100000000000000100000000000000001000,0000000000000000001000001011000000000000000000000000000001000000000000000000000100000000000010001000,0000000000000000110000000011010000000000000000000000000001000000000010000000001100000000001110000110,0000000000000000000000000100000000000100000000000000000001000000001000000000000000000000000100000000,0000100000000000000000000000000000001000000100000000000000000000000011100001010000011000011100000001,0110000000000000000000000000000000010100000000000000000000000000000000110000000000000100000000000001,0010100001000000000000000000000000010000000100000000010100000000000000010000000000001000000000000000,0110000000001000010000000000000000000000000000000000010100000000000000000000000000000000000000000000,0000111000101000011000000000001100000000000000000000000100010000000000000010000000000000000000010000,1100000000001101000000000000000000000000000000000000000000011000000000001000000000000000000000000000,1000000010000000010000000000000000000000000000010000000000001010000000100000000000000000000000000001,1000000000000011000000100000100000000000000001000000000000000001100000000000000000000010000000000000,1000000000000000000000100000000000000000000000000000000000000010100000000000110000101000000000000001,0000000000000000000000100000000000000000000000000000000000010000000010000000000000000000000000000000,1000000000010000000000000000000000000000000000000010000000000000000000000000000000000001100000000001,0010000011100000000000000000000000000000000000000110000100001000000001010000000000000001010000000001,1000000000000000000110000000000000000010000000101000000000000000000000011100000000000000000000000110,0000000001000000000000000000000000000000010000001000000010000000000100100000000000000000100000000010,1000000000000000000000000000000000000000000000001100000000000000010011010000000000000000000000000010,0000000000000000001000000000000000010000000000000100000000000000100100010000000000000000000001000001,1100000000000000010001110000000001100000000000000000000000000000101010010000000001000000000010000001,0000000000000000011100000000000000000000000001000000000000000100000000100000000010000000000000100001,1000000000000000000011110000100011000000000000000000000000000000000000000000000000000000011100000001,0000000000000000000000000000000000000000000000000000000010000000000000000000000000000000011000000001,0000000000000000000000000000100010000000000000000000000000000000001100000000000000000000011000000001,0000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000011,1000000000000000000000000110000010000000000000000000000000000000000000000000011100000000000000000001,0110000000000000000000000011000011000000000000000000000000000000000000000000000000000000000000000000,0000000000000000000000000000000000000000000000000000000000000000000000000000000101100000000000000000,1110000001100000000001000010000111000000000000000000000000000000001100000000000000000000000000000000,0000100000000000001000000000000000000000000000000000000010000000001100000000000000000000000000010000,0000000000100000000000000001000100000000000000000000000000000010000000000000000000000000000001000000,0001100000000000000000000000010000000000000000101000000000001010000000000001000000000000000000000001,0000000000100000000000000000000000000001000000000000000000000100000000111000001000000000000000000001,0001000000000000000000000000000001000000000000010000000000000000000000000000100000000000000000000001,0000000000000000000000010000000101000000000000000000000000000000000000000000000000000000000000000001,0000000000000000000001000010100000000000001000000000000001000000000000000000000000000000000000000001,1000000000000000000001110011111110000000001000000000000010100000000000000001000000000010000000000001,1001000000010000000000000001000000000000000000010000000000000000000000000000000000000000000000000001,0000000000000000010000000001000000000000000000010000000000110000000000000001000000000111100000000001,1000000000000100010000000000000000000000000000000000000000000000000000000001000000000000000000000000,1010000000000101000000000000000000000010000001000000000000011100000000111101000000000001100000010000,1000000011000001000000000000100000000000000000000000000000000100000001101100100000000000000000000001,1100000001100001000110000000100000000001000000000000000000000000000000010010000000000001010000001010,0000000110000101000000000000000000000000000000000000000000000000000000000010100011010000001000001010,0000000000000011000100000000000110000000000000001100010100000000000000000000000000000000000000001101,0000000000001011000000000000000010000000000000001000000000000000000000000000000000000000000000000001,0000000000000000000000000000011000000000000000001000000000000000000000000000000000000000000000001101,1000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000001100001,0000000000000000000001000000000000000000000000100000000000000000000000000000000000000000000000010101,1000000000000000000000000000000000000000000000000000000100000000010000000000000000000001000010000000,1000000000100010000010101010100101001111000001100011011011011101100001010010101101001100111111010101";

    // initializes the grid and splits the strings into arrays
    Cell[][] check_grid = new Cell[100][100];
    String[] check_lines = check.split(",");
    String[] answer_lines = answer.split(",");

    // iterates through the grid and sets check_grid
    for (int row = 0; row < 100; row++) {
      for (int col = 0; col < 100; col++) {
        Cell cell = new Cell(row, col);
        boolean isAlive = check_lines[row].charAt(col) == '1';
        cell.setAlive(isAlive);
        check_grid[row][col] = cell;
      }
    }

    // checks each cell and asserts that the Cell class correctly identifies its
    // next state
    for (int row = 0; row < 100; row++) {
      for (int col = 0; col < 100; col++) {
        if (check_grid[row][col].shouldLive(check_grid) != (answer_lines[row].charAt(col) == '1')) {
          System.out.println("Your Cell class doesn't seem to be working! Would you like to continue anyway? (yes/no)");
          Scanner scanner = new Scanner(System.in);
          String response = scanner.next();
          scanner.close();
          if (response.toLowerCase().startsWith("y")) {
            return;
          } else {
            System.exit(0);
          }
        }
      }
    }
  }

  /**
   * Tests the Cell class and initializes the graphics
   */
  public GameOfLife() {
    testCell();

    setTitle("Conway's Game Of Life");
    setResizable(false);
    setVisible(true);
    setDefaultCloseOperation(EXIT_ON_CLOSE);
    initGUI();
    pack();
  }

  /**
   * initGUI, a standard abbreviation of "initialize Graphical User Interface",
   * sets up the graphics and loop timer using Java Swing.
   */
  private void initGUI() {
    JPanel main = new JPanel();
    main.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));
    main.setLayout(new BorderLayout());
    setContentPane(main);

    // adds banner
    JLabel titleLabel = new JLabel("Conway's Game of Life", SwingConstants.CENTER);
    titleLabel.setFont(new Font("arial", Font.BOLD, 32));
    titleLabel.setOpaque(true);
    titleLabel.setBackground(Color.BLACK);
    titleLabel.setForeground(Color.WHITE);
    add(titleLabel, BorderLayout.NORTH);

    // adds the grid of buttons
    JPanel gridPanel = new JPanel();
    gridPanel.setLayout(new GridLayout(gridSize, gridSize));
    // initializes a Cell and CellButton for each cell
    for (int row = 0; row < gridSize; row++) {
      for (int col = 0; col < gridSize; col++) {
        CellButton button = new CellButton(row, col);
        Cell cell = new Cell(row, col);
        buttons[row][col] = button;
        cells[row][col] = cell;
        gridPanel.add(button);
        // adds an action listener to the CellButton
        // this defines what it should do when clicked
        button.addActionListener(new ActionListener() {
          public void actionPerformed(ActionEvent e) {
            if (!running) {
              CellButton cellButton = (CellButton) e.getSource();
              int row = cellButton.row;
              int col = cellButton.col;
              cells[row][col].setAlive(!cells[row][col].isAlive());
              cellButton.toggle();
            }
          }
        });
      }
    }
    add(gridPanel, BorderLayout.CENTER);

    // initializes the timer and sets it to call tick() every speed milliseconds
    Timer timer = new Timer(speed, new ActionListener() {
      public void actionPerformed(ActionEvent e) {
        tick();
      }
    });

    JPanel buttonPanel = new JPanel();
    buttonPanel.setLayout(new BoxLayout(buttonPanel, BoxLayout.X_AXIS));
    JButton resetButton = new JButton("Reset");
    JButton pauseButton = new JButton("Start");
    // sets the pause button
    pauseButton.addActionListener(new ActionListener() {
      public void actionPerformed(ActionEvent e) {
        running = !running;
        JButton button = (JButton) e.getSource();
        button.setText(running ? "Stop" : "Start");
        resetButton.setEnabled(!running);
      }
    });
    buttonPanel.add(pauseButton);
    // sets the reset button
    JSlider slider = new JSlider(0, 1000, speed);
    resetButton.addActionListener(new ActionListener() {
      public void actionPerformed(ActionEvent e) {
        for (int row = 0; row < gridSize; row++) {
          for (int col = 0; col < gridSize; col++) {
            if (cells[row][col].isAlive()) {
              cells[row][col].setAlive(false);
              buttons[row][col].toggle();
            }
          }
        }
        slider.setValue(speed);
        timer.setInitialDelay(slider.getValue());
        timer.setDelay(slider.getValue());
        timer.restart();
      }
    });
    buttonPanel.add(resetButton);

    // sets the speed slider
    Hashtable<Integer, JLabel> labelMap = new Hashtable<Integer, JLabel>();
    labelMap.put(0, new JLabel("0 ms"));
    labelMap.put(1000, new JLabel("1000 ms"));
    slider.setLabelTable(labelMap);
    slider.setPaintLabels(true);
    slider.setMajorTickSpacing(100);
    slider.setPaintTicks(true);
    slider.addChangeListener(new ChangeListener() {
      public void stateChanged(ChangeEvent e) {
        timer.setInitialDelay(slider.getValue());
        timer.setDelay(slider.getValue());
        timer.restart();
      }
    });
    buttonPanel.add(slider);

    add(buttonPanel, BorderLayout.SOUTH);
    timer.start();
  }

  /**
   * Tick is called every _ milliseconds for the number of milliseconds shown on
   * the speed slider.
   */
  private void tick() {
    if (running) {
      // checks each cell to see if it should live
      boolean[][] newStates = new boolean[gridSize][gridSize];
      for (int row = 0; row < gridSize; row++) {
        for (int col = 0; col < gridSize; col++) {
          newStates[row][col] = cells[row][col].shouldLive(cells);
        }
      }

      // sets each cell based on the previous result
      for (int row = 0; row < gridSize; row++) {
        for (int col = 0; col < gridSize; col++) {
          if (cells[row][col].isAlive() != newStates[row][col]) {
            cells[row][col].setAlive(newStates[row][col]);
            buttons[row][col].toggle();
          }
        }
      }
    }
  }

  /**
   * This is the main method that calls the GameOfLife constructor.
   */
  public static void main(String[] arg0) {
    new GameOfLife();
  }

  /**
   * CellButton is a private helper class. It acts the same as a JButton,
   * but stores its location information and has a method to toggle it.
   */
  private class CellButton extends JButton {
    public int row;
    public int col;
    public boolean isAlive = false;

    /**
     * This is the CellButton constructor.
     */
    public CellButton(int row, int col) {
      this.row = row;
      this.col = col;
      setPreferredSize(new Dimension(600 / gridSize, 600 / gridSize));
      setBackground(Color.BLACK);
    }

    /**
     * This updates the color of the button.
     */
    public void toggle() {
      isAlive = !isAlive;
      setBackground(isAlive ? Color.WHITE : Color.BLACK);
    }
  }
}